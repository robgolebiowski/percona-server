CREATE TABLE t1 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL, SPATIAL index(coordinate)) ENGINE=INNODB
ENCRYPTION='KEYRING';
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
CREATE TABLE t2 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL, SPATIAL index(coordinate)) ENGINE=INNODB;
ALTER TABLE t2 ENCRYPTION='KEYRING';
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
DROP TABLE t2;
CREATE TABLE t1 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL) ENCRYPTION='KEYRING' ENGINE=INNODB;
ALTER TABLE t1 ADD SPATIAL INDEX b(coordinate), ALGORITHM=COPY;
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
ALTER TABLE t1 ADD SPATIAL INDEX b(coordinate), FORCE, ALGORITHM=INPLACE;
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
CREATE SPATIAL INDEX b on t1(coordinate);
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
ALTER TABLE t1 ADD SPATIAL INDEX(coordinate);
ERROR HY000: InnoDB: ENCRYPTED='KEYRING' not supported for table because it contains spatial index.
DROP TABLE t1;
CREATE TABLE t1 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL) ENGINE=INNODB;
CREATE SPATIAL INDEX b on t1(coordinate);
INSERT INTO t1 values(1, 'secret', ST_GeomFromText('POINT(903994614 180726515)'));
ALTER TABLE t1 DROP INDEX b;
INSERT INTO t1 values(2, 'secret', ST_GeomFromText('POINT(903994614 180726515)'));
ALTER TABLE t1 ADD SPATIAL INDEX b(coordinate);
INSERT INTO t1 values(3, 'secret', ST_GeomFromText('POINT(903994614 180726515)'));
DROP TABLE t1;
CREATE TABLE t1 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL, SPATIAL index(coordinate)) ENGINE=INNODB;
CREATE TABLE t2 (pk INT PRIMARY KEY AUTO_INCREMENT,
c VARCHAR(256), coordinate POINT NOT NULL, SPATIAL index(coordinate)) ENGINE=INNODB COMPRESSION="zlib";
INSERT INTO t1 values(1, 'secret', ST_GeomFromText('POINT(903994614 180726515)'));
INSERT INTO t2 values(1, 'secret', ST_GeomFromText('POINT(903994614 180726515)'));
SET GLOBAL innodb_encrypt_tables=ONLINE_TO_KEYRING;
# Success!
SELECT NAME FROM INFORMATION_SCHEMA.INNODB_TABLESPACES_ENCRYPTION WHERE MIN_KEY_VERSION > 0;
NAME
innodb_system
mysql/engine_cost
mysql/gtid_executed
mysql/help_category
mysql/help_keyword
mysql/help_relation
mysql/help_topic
mysql/innodb_index_stats
mysql/innodb_table_stats
mysql/plugin
mysql/server_cost
mysql/servers
mysql/slave_master_info
mysql/slave_relay_log_info
mysql/slave_worker_info
mysql/time_zone
mysql/time_zone_leap_second
mysql/time_zone_name
mysql/time_zone_transition
mysql/time_zone_transition_type
sys/sys_config
test/t1
test/t2
SELECT NAME FROM INFORMATION_SCHEMA.INNODB_TABLESPACES_ENCRYPTION WHERE MIN_KEY_VERSION = 0;
NAME
DROP TABLE t1, t2;
SET GLOBAL innodb_encrypt_tables=OFF;
