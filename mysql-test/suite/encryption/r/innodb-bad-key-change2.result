call mtr.add_suppression("The page \\[page id: space=4, page number=[1-9]*\\] in file '.*test.t1(new)?\\.ibd' cannot be decrypted\\.");
call mtr.add_suppression("\\[InnoDB\\] Space to be marked as encrypted was not found for id");
call mtr.add_suppression("Table test/t1 is encrypted but decryption failed\\. Seems that the encryption key fetched from keyring is not the correct one\\. Are you using the correct keyring?");
call mtr.add_suppression("Table t1 is encrypted but decryption failed\\. Seems that the encryption key fetched from keyring is not the correct one\\. Are you using the correct keyring?");
call mtr.add_suppression("Tablespace for table `test`\\.`t1` is set as discarded");
call mtr.add_suppression("Error code: 105 btr_pcur_t::open  level: 0");
call mtr.add_suppression("Table SDI_4 is encrypted but decryption failed\\. Seems that the encryption key fetched from keyring is not the correct one\\. Are you using the correct keyring?");
CREATE TABLE t1 (pk INT PRIMARY KEY, f VARCHAR(8)) ENGINE=InnoDB ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=4;
INSERT INTO t1 VALUES (1,'foo'),(2,'bar');
# restart:--keyring-file-data=MYSQLTEST_VARDIR/std_data/keys3.txt
SET GLOBAL innodb_stats_persistent=OFF;
SELECT * FROM t1;
ERROR HY000: Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
SHOW WARNINGS;
Level	Code	Message
Error	1296	Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
ALTER TABLE t1 ENGINE=InnoDB;
ERROR HY000: Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
SHOW WARNINGS;
Level	Code	Message
Error	1296	Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
OPTIMIZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	optimize	Error	Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
test.t1	optimize	error	Corrupt
SHOW WARNINGS;
Level	Code	Message
CHECK TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	check	Error	Got error 500 'Table encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?' from InnoDB
test.t1	check	error	Corrupt
SHOW WARNINGS;
Level	Code	Message
# restart:--keyring-file-data=MYSQLTEST_VARDIR/std_data/keys2.txt
SET GLOBAL innodb_stats_persistent=OFF;
FLUSH TABLES t1 FOR EXPORT;
backup: t1
UNLOCK TABLES;
# restart:--keyring-file-data=MYSQLTEST_VARDIR/std_data/keys3.txt
SET GLOBAL innodb_stats_persistent=OFF;
ALTER TABLE t1 DISCARD TABLESPACE;
Warnings:
Warning	1812	InnoDB: Tablespace is missing for table test/t1.
restore: t1 .ibd and .cfg files
# restart:--keyring-file-data=MYSQLTEST_VARDIR/std_data/keys2.txt
SET GLOBAL innodb_stats_persistent=OFF;
ALTER TABLE t1 IMPORT TABLESPACE;
Warnings:
Warning	1814	InnoDB: Tablespace has been discarded for table 't1'
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `pk` int(11) NOT NULL,
  `f` varchar(8) DEFAULT NULL,
  PRIMARY KEY (`pk`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=4
# restart: --keyring-file-data=MYSQLTEST_VARDIR/std_data/keys3.txt
SET GLOBAL innodb_stats_persistent=OFF;
RENAME TABLE t1 TO t1new;
ERROR HY000: Table test/t1new is encrypted but decryption failed. Seems that the encryption key fetched from keyring is not the correct one. Are you using the correct keyring?
ALTER TABLE t1new RENAME TO t2new;
ERROR 42S02: Table 'test.t1new' doesn't exist
DROP TABLE t1new;
ERROR 42S02: Unknown table 'test.t1new'
