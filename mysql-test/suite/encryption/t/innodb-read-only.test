call mtr.add_suppression(".* in InnoDB read only mode");
call mtr.add_suppression(".* in InnoDB read-only mode");

--let encrypted_tables_count=`select count(*) from INFORMATION_SCHEMA.INNODB_TABLESPACES`
#We do not encrypt temporary tablespace, but we do encrypt innodb_system which is not listed in INNODB_TABLESPACES
--echo # Wait max 10 min for key encryption threads to encrypt all spaces
--echo $encrypted_tables_counts
--let $wait_timeout= 600
--let $wait_condition=SELECT COUNT(*) = $encrypted_tables_count FROM INFORMATION_SCHEMA.INNODB_TABLESPACES_ENCRYPTION WHERE MIN_KEY_VERSION = 1
--source include/wait_condition.inc

--echo # Success!

#
# MDEV-11835: InnoDB: Failing assertion: free_slot != NULL on
# restarting server with encryption and read-only
#
--let $restart_parameters=restart:--innodb-read-only=1 --innodb-encrypt-tables=ONLINE_TO_KEYRING
--source include/restart_mysqld.inc
--echo # All done
